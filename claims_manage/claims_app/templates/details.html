<div class="row row3" x-data="{}">
    <template x-if="$store.patientData.selectedPatient">
        <div class="card-medical">
            <div class="card-header">
                <h3 x-text="$store.patientData.selectedPatient?.patient_name" class="patient-name"></h3>
                <span x-text="$store.patientData.selectedPatient?.status" 
                x-bind:class="'s ' + $store.patientData.selectedPatient?.status.toLowerCase().replace(' ', '-')"
                ></span>
            </div>

            <div class="claim-info">
                <strong>Claim ID:</strong> <span x-text="$store.patientData.selectedPatient?.id"></span><br>
                <strong>Discharge:</strong> <span x-text="$store.patientData.selectedPatient?.discharge_date"></span>
            </div>

            <div class="financial-summary">
                <div class="amount-card">
                    <div class="amount-value billed">
                        <span x-text="formatCurrency($store.patientData.selectedPatient?.billed_amount)"></span>
                    </div>
                    <div class="amount-label">Billed</div>
                </div>
                <div class="amount-card">
                    <div class="amount-value paid-info">
                        <span x-text="formatCurrency($store.patientData.selectedPatient?.paid_amount)"></span>
                    </div>
                    <div class="amount-label">Paid</div>
                </div>
            </div>

            <div class="insurer-info">
                <strong>Insurer:</strong> <span x-text="$store.patientData.selectedPatient?.insurer_name"></span>
            </div>
            
            <template x-if="$store.patientData.additionalDetails && !$store.patientData.loadingDetails">
                <div class="insurer-info">
                    <strong>CPT Codes:</strong> <span x-text="$store.patientData.additionalDetails.cpt_codes || 'N/A'"></span>
                </div>
            </template>
            
            <template x-if="$store.patientData.loadingDetails">
                <div class="insurer-info">
                    <strong>CPT Codes:</strong> <span>Loading...</span>
                </div>
            </template>
            
            <template x-if="$store.patientData.additionalDetails && !$store.patientData.loadingDetails">
                <div class="issue-alert" style="margin-top: 0px">
                    <strong>Denial Reason:</strong>
                    <small x-text="$store.patientData.additionalDetails.denial_reason || 'N/A'"></small>
                </div>
            </template>
        </div>
    </template>
    
    <!-- Placeholder for the details card -->
    <template x-if="!$store.patientData.selectedPatient">
        <div class="card-medical">
            <h3 class="card-header">Choose a claim from the table</h3>
        </div>
    </template>

    <template x-if="!$store.patientData.selectedPatient">
        <div class="card-notes">
            <h3 class="card-header">Choose a claim from the table</h3>
        </div>
    </template>

    <template x-if="$store.patientData.selectedPatient">
        <div class="card-notes" x-data="notesApp()">
            <div class="section-header">
                <i class="fas fa-sticky-note"></i>
                <h4>Notes & Annotations</h4>
            </div>
            
            <div class="flag-section">
                <button 
                    class="flag-btn" 
                    x-bind:class="{ 'flagged' : isFlagged }"
                    @click="toggleFlag()"
                >
                    <i :class="isFlagged ? 'fas fa-flag' : 'far fa-flag'"></i>
                    <span x-text="isFlagged ? 'Unflag Claim' : 'Flag Claim'"></span>
                </button>
            </div>
            
            <div class="notes-input-section">
                <textarea 
                    class="text-input"
                    x-model="noteText"
                    placeholder="Enter your note here (max 100 characters)..."
                    maxlength="100"
                    @input="updateCharCount()"
                ></textarea>
                
                <div class="char-counter" 
                    :class="{
                        'warning': charCount > 80,
                        'danger': charCount >= 95
                    }">
                    <span x-text="charCount"></span>/100 characters
                </div>
                
                <button 
                    class="submit-btn"
                    :disabled="noteText.trim().length === 0"
                    @click="submitNote()"
                >
                    <i class="fas fa-paper-plane"></i>
                    Submit Note
                </button>
            </div>
        </div>
    </template>
</div>